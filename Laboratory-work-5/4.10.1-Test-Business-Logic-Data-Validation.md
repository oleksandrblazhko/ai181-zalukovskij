# Протестуйте перевірку даних бізнес-логіки

|ID|
|-|
|WSTG-BUSL-01|

## Резюме

Застосунок має гарантувати, що лише логічно достовірні дані можна вводити на інтерфейсі, а також безпосередньо на стороні сервера програми або системи. Лише локальна перевірка даних може зробити програми вразливими до серверних ін’єкцій через проксі-сервери або під час передачі даних з іншими системами. Це відрізняється від простого аналізу граничних значень (BVA) тим, що це складніше, і в більшості випадків його неможливо просто перевірити на вході, але зазвичай вимагає перевірки іншої системи.

Наприклад: програма може запитувати ваш номер соціального страхування. У BVA програма повинна перевіряти формати та семантику (це значення має довжину 9 цифр, не від’ємне число і не всі 0) для введених даних, але є також логічні міркування. Ця особа в досьє про смерть? Вони з певної частини країни?

Уразливості, пов’язані з перевіркою бізнес-даних, унікальні тим, що вони стосуються конкретної програми та відрізняються від уразливостей, пов’язаних із підробкою запитів, оскільки вони більше стурбовані логічними даними, а не просто порушують робочий процес бізнес-логіки.

Інтерфейс і бек-енд програми повинні перевіряти та підтверджувати, що дані, які він має, використовує та передає, є логічно достовірними. Навіть якщо користувач надає програмі дійсні дані, бізнес-логіка може змусити програму поводитися по-різному залежно від даних або обставин.

### Приклад 1

Припустімо, ви керуєте багаторівневим сайтом електронної комерції, який дозволяє користувачам замовляти килим. Користувач вибирає свій килим, вводить розмір, здійснює платіж, а зовнішня програма перевіряє, чи вся введена інформація правильна та дійсна щодо контактної інформації, розміру, марки та кольору килима. Але бізнес-логіка у фоновому режимі має два шляхи: якщо килим є в наявності, він відправляється безпосередньо з вашого складу, але якщо його немає в наявності на вашому складі, здійснюється виклик до системи партнера, і якщо він є в нього в наявності, вони відправлять замовлення зі свого складу та компенсують вартість. Що станеться, якщо зловмиснику вдасться продовжити дійсну транзакцію в наявності та надіслати її вашому партнеру як те, що немає в наявності? Що станеться, якщо зловмиснику вдасться потрапити всередину і надіслати повідомлення на склад партнера, замовивши килим без оплати?

### Приклад 2

Багато систем кредитних карток в даний час завантажують баланси рахунків щоночі, щоб клієнти могли швидше розплачуватися сумами менше певного значення. Правильне і зворотне. Якщо я розплачуся кредитною карткою вранці, я не зможу використати доступний кредит увечері. Іншим прикладом може бути те, що якщо я використовую свою кредитну картку в кількох місцях дуже швидко, можливо можливе перевищення мого ліміту, якщо системи засновують рішення на даних минулої ночі.

### Приклад 3

Distributed Denial of Dollar (DDo$): це була кампанія, запропонована засновником веб-сайту «The Pirate Bay» проти юридичної фірми, яка порушила судові переслідування проти «The Pirate Bay». Мета полягала в тому, щоб скористатися помилками в дизайні бізнес-функцій і в процесі підтвердження кредитного переказу.

Ця атака була здійснена шляхом надсилання дуже невеликих сум грошей у розмірі 1 шведської крони (0,13 доларів США) до юридичної фірми. Банківський рахунок, на який спрямовувалися платежі, мав лише 1000 безкоштовних переказів, після чого будь-які перекази мають доплату для власника рахунку (2 шведські крони). Після першої тисячі інтернет-транзакцій кожна пожертва 1 шведської крони юридичній фірмі фактично коштуватиме їй 1 шведську крону.

## Цілі тесту
- Визначити точки введення даних.
- Переконайтися, що всі перевірки відбуваються на сервері та їх неможливо обійти.
- Спробувати порушити формат очікуваних даних і проаналізувати, як програма їх обробляє.

## Як тестувати

### Загальний метод тестування

- Перегляньте проектну документацію та використовуйте дослідницьке тестування для пошуку точок входу даних або точок передачі між системами чи програмним забезпеченням.
- Знайшовши, спробуйте вставити логічно недійсні дані в програму/систему.

### Конкретний метод тестування:

- Виконайте функціональне тестування графічного інтерфейсу в програмі, щоб переконатися, що приймаються лише «дійсні» значення.
- Використовуючи проксі-перехоплювач, спостерігайте за HTTP POST/GET, шукаючи місця, де передаються такі змінні, як вартість і якість. Зокрема, шукайте «передачі» між програмами/системами, які можуть бути можливими точками ін’єкції або втручання.
- Коли змінні знайдені, почніть опитувати поле з логічно «недійсними» даними, такими як номери соціального страхування або унікальні ідентифікатори, яких не існує або які не відповідають бізнес-логіці. Це тестування перевіряє, що сервер працює належним чином і не приймає логічно недійсні дані.

## Пов’язані тестові випадки

- Усі тестові випадки [перевірки вхідних даних](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/07-Input_Validation_Testing/README).
- [Тестування для перерахування облікових записів і вгадування облікових записів користувачів.](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account)
- [Тестування на обхід схеми керування сеансами.](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/06-Session_Management_Testing/01-Testing_for_Session_Management_Schema)
- [Тестування відкритих змінних сеансу.](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/06-Session_Management_Testing/04-Testing_for_Exposed_Session_Variables)

## Виправлення

Програма/система має гарантувати, що лише «логічно достовірні» дані приймаються в усіх точках введення та передачі програми чи системи, а дані не просто довіряються після того, як вони надійшли в систему.

## Інструменти

- [OWASP Zed Attack Proxy (ZAP)](https://www.zaproxy.org/)
- [Burp Suite](https://portswigger.net/burp)

## Список літератури

- [OWASP Proactive Controls (C5) - Validate All Inputs](https://owasp.org/www-project-proactive-controls/v3/en/c5-validate-inputs)
- [OWASP Cheatsheet Series - Input_Validation_Cheat_Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html)
